# 他AI相談 - 運用ガイドライン

## 概要

デバッグや問題解決が泥沼にはまった際、AIから他のAIへの相談を提案し、効率的に問題を解決するためのガイドラインです。

---

## AIから相談を提案する発生条件

以下のいずれかの条件に該当した場合、AIは**即座に**他のAIへの相談を提案します。

### 1. 同じアプローチの繰り返し（3回ルール）
- **条件**: 同じカテゴリの対処法を3回以上試しても解決しない
- **例**: 
  - 設定ファイルの修正を3回繰り返す
  - コードのrevert/再適用を3回繰り返す
  - 環境変数の調整を3回繰り返す

### 2. 時間経過（30分ルール）
- **条件**: 最初の問題発生から30分（約10-15ステップ）経過しても解決しない
- **判断基準**: 
  - 初回エラー発生時刻を記録
  - 30分経過時に進展がない場合、提案

### 3. 理論と現実の齟齬
- **条件**: コードが理論上正しいのにエラーが継続
- **例**:
  - APIドキュメント通りの実装でエラー
  - 公式推奨の設定でエラー
  - 過去に動いていたコードが突然動かない

### 4. フレームワーク/ライブラリ内部のエラー
- **条件**: スタックトレースがフレームワーク/ライブラリの内部実装を指している
- **例**:
  - `node:internal/...`
  - `next/dist/...`
  - `undici/...`
  - サードパーティライブラリの深い階層

### 5. ユーザーの明確な疲労・不満の表明
- **条件**: ユーザーが以下のような発言をした場合
- **例**:
  - 「いい加減にして」
  - 「何度も同じことを」
  - 「全然進まない」
  - 「解決しない」

---

## 提案時のメッセージ

以下のようなメッセージで提案します：

```
問題解決が難航しているため、他のAI（専門家）への相談を推奨します。

【発生条件】
- [該当する条件を明記]

【相談内容】
問題サマリーを作成しますので、他のAIに共有していただけますでしょうか？
5-10分で的確な回答が得られる可能性が高いです。

作成しますか？
```

---

## 質問項目に含める内容

### 必須項目

#### 1. 現在の状況
- **プロジェクト概要**: 技術スタック、環境（OS、バージョン等）
- **発生している問題**: エラーメッセージの全文
- **症状**: いつ、どこで、何をしたときにエラーが発生するか

#### 2. エラーの詳細
- **エラーメッセージ**: 完全な文字列
- **スタックトレース**: 可能な限り全文（特に最初の5-10行）
- **エラー発生箇所**: ファイル名、行番号
- **エラーの性質**: 500エラー、コンパイルエラー、ランタイムエラーなど

#### 3. 試したこと
- **実施した対処法**: 時系列順にリスト化
- **各対処法の結果**: 効果の有無、変化した点
- **参考にした情報源**: 公式ドキュメント、Stack Overflowなど

#### 4. 関連ファイルとコード
- **問題に関連するファイル**: パスと役割
- **関連するコードスニペット**: 最小限で再現可能なコード
- **設定ファイル**: package.json、.env、next.config.jsなど

#### 5. 技術スタック
- **言語・フレームワーク**: 名前とバージョン
- **主要ライブラリ**: 名前とバージョン
- **環境**: ローカル、本番、CI/CDなど

#### 6. 質問したいこと（具体的に）
- **メインの質問**: 1-3つに絞る
- **サブの質問**: 関連する疑問点
- **期待する回答**: どのような情報が欲しいか明記

### オプション項目（状況に応じて）

- **過去に動いていた時期**: いつまで正常だったか
- **最近の変更**: コード、設定、環境の変更点
- **他の環境での動作**: ローカルでは動くが本番でNGなど
- **ログ出力**: 関連するログメッセージ

---

## 質問フォーマット（テンプレート）

```markdown
# [問題の簡潔なタイトル] - 問題サマリー

## 現在の状況

**プロジェクト**: [プロジェクト名] ([技術スタック])
**環境**: 
- ローカル: [OS, 言語バージョン等]
- 本番: [環境情報]

**発生している問題**:
[エラーメッセージまたは症状の簡潔な説明]

```
[エラーメッセージの全文]
```

## 何をしたいか

1. [目標1]
2. [目標2]

## エラーの詳細

### スタックトレース
```
[スタックトレースの全文]
```

### 問題の詳細
- **エラー発生箇所**: [ファイル名:行番号]
- **エラーの性質**: [500エラー、JSONパースエラーなど]
- **問題の本質**: [現象から推測される原因]

## 試したこと（すべて失敗）

1. **[対処法1]**
   - 実施内容: [具体的な変更]
   - 結果: [効果なし、別のエラー発生など]

2. **[対処法2]**
   - 実施内容: [具体的な変更]
   - 結果: [効果なし、別のエラー発生など]

## 関連ファイル

### [カテゴリ1（例：フロントエンド）]
- `[ファイルパス]` - [役割]

### [カテゴリ2（例：バックエンド）]
- `[ファイルパス]` - [役割]

### 関連コードスニペット

#### [ファイル名:行番号]
```[言語]
[コードスニペット]
```

## 技術スタック

- **フレームワーク**: [名前] [バージョン]
- **主要ライブラリ**: [名前] [バージョン]
- **データベース**: [名前] [バージョン]
- **デプロイ**: [環境名]

## 質問したいこと

1. **[メイン質問1]**
   - [補足説明]

2. **[メイン質問2]**
   - [補足説明]

3. **[メイン質問3]**
   - [補足説明]

## 追加情報

- [その他の関連情報]
- [過去に動いていた時期など]
```

---

## 質問ファイルの保存先

- **パス**: `C:\Users\takuy\Desktop\売上管理システム\相談と回答\[問題名]_問題サマリー_[日付].md`
- **命名規則**: `[問題の簡潔な説明]_問題サマリー_YYYYMMDD.md`
- **例**: `CSV取込エラー_問題サマリー_20251223.md`

---

## 回答を受け取った後のフロー

1. **回答をAIに共有**
   - ユーザーが回答をチャットに貼り付ける
   - AIが「まだ何もしないで」と指示されるまで待機

2. **AIが回答を分析**
   - 突破口が見えたか判断
   - 不明点があれば追加質問を作成

3. **実装開始**
   - ユーザーの許可を得て実装開始
   - 判断に迷う場合は再度質問を作成

---

## 注意事項

### AIが守るべきルール

1. **提案は早めに**: 30分経過で必ず提案
2. **ユーザーの負担を最小化**: 質問文は自動生成
3. **状況整理を明確に**: 何を試して、何が失敗したかを明確に記述
4. **コードは最小限**: 問題に直接関連する部分のみ

### ユーザーが守るべきルール

1. **回答を共有する際**: 「まだ何もしないで」と指示
2. **追加質問の承認**: AIが作成した追加質問を確認してから送信
3. **フィードバック**: 回答が役立ったかどうかを共有

---

## チェックリスト（AI用）

以下の条件を満たした場合、他のAIへの相談を提案する：

- [ ] 同じアプローチを3回繰り返した
- [ ] 30分経過しても解決しない
- [ ] 理論上正しいコードでエラーが継続
- [ ] スタックトレースがフレームワーク内部を指している
- [ ] ユーザーが疲労・不満を表明

問題サマリーに含める内容：

- [ ] 現在の状況（プロジェクト、環境、問題）
- [ ] エラーの詳細（メッセージ、スタックトレース）
- [ ] 試したこと（すべての対処法と結果）
- [ ] 関連ファイルとコード
- [ ] 技術スタック
- [ ] 具体的な質問（1-3つ）

---

## 成功事例

### V1.51 CSV取込エラー

- **発生条件**: 30分経過 + 同じアプローチ3回繰り返し
- **提案タイミング**: デバッグ開始から約1時間後
- **結果**: 他のAIからの回答により、URL不一致という根本原因を即座に特定
- **解決時間**: 相談から解決まで約15分

---

このガイドラインに従うことで、効率的に問題解決を進めることができます。
