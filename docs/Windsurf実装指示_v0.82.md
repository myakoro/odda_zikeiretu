# Windsurf向け実装指示: v0.82 Webダッシュボード更新

**作成日**: 2025-12-23  
**対象バージョン**: v0.82  
**担当**: Windsurf  
**重要**: 既存機能を壊さないアップデートです

---

## 🎯 あなたの役割

**Webダッシュボードに複勝オッズ表示機能を追加してください。**

バックエンド(Python)は既に完成しており、複勝オッズデータが取得できる状態です。
あなたはフロントエンド(HTML/CSS/JavaScript)のみを修正します。

---

## ⚠️ 重要な注意事項

### 既存機能を壊さない
- 現在の単勝オッズ表示機能は**そのまま維持**してください
- 既存のコードは可能な限り変更せず、**追加のみ**で実装してください
- 既存のAPI呼び出しは変更しないでください

### 質問・相談について
- 実装方針に迷った場合は**必ず中断して質問**してください
- 既存コードの意図が不明な場合も質問してください
- 「たぶんこうだろう」で進めないでください

---

## 📁 参照すべきファイル

### 必須参照ファイル
1. **要件定義書**: `docs/要件定義書/要件定義書_v0.82.md`
   - 3.6節「Webダッシュボード機能」を参照
   - F-021「オッズ分析画面の拡張」を確認

2. **詳細設計書**: `docs/詳細設計書/詳細設計書_v0.82.md`
   - 18節「Webダッシュボード設計」を参照
   - HTML/CSS/JavaScriptの実装例を確認

### 修正対象ファイル
1. **web/index.html** - HTML構造の追加
2. **web/app.js** - JavaScript実装
3. **web/style.css** - スタイル追加

### 参照のみ(変更不要)
- **src/api_server.py** - APIは既に複勝オッズを返しています(変更不要)
- **src/parser.py** - バックエンドは完成済み(変更不要)

---

## 📋 実装内容

### 1. 追加する機能

#### オッズ表示切り替えボタン
- 「単勝のみ」「複勝のみ」「両方表示」の3つのボタン
- クリックでグラフの表示を切り替え

#### 複勝オッズグラフ
- 複勝オッズ下限のライン(破線)
- 複勝オッズ上限のライン(破線)
- 下限と上限の範囲を塗りつぶし表示

#### 凡例
- 単勝オッズ: 実線
- 複勝下限: 破線(下)
- 複勝上限: 破線(上)
- 複勝範囲: 半透明の塗りつぶし

---

## 🔧 実装手順

### Step 1: APIレスポンスの確認
既存のAPI `/api/race/<race_id>/odds` は以下のデータを返します:

```json
{
  "odds_history": [
    {
      "time_stamp": "2025-12-06 18:31",
      "umaban": 1,
      "odds_tan": 3.2,
      "odds_fuku_min": 1.2,
      "odds_fuku_max": 1.8,
      "popularity": 1
    },
    ...
  ]
}
```

**重要**: `odds_fuku_min` と `odds_fuku_max` が既に含まれています。

### Step 2: HTML修正 (web/index.html)

**詳細設計書の18.1.1節を参照してください。**

追加箇所:
- オッズ表示切り替えボタン
- グラフの凡例

### Step 3: JavaScript修正 (web/app.js)

**詳細設計書の18.1.2節を参照してください。**

実装内容:
1. APIレスポンスから `odds_fuku_min`, `odds_fuku_max` を取得
2. Chart.jsのデータセットに複勝オッズを追加
3. ボタンクリックイベントでグラフの表示/非表示を切り替え

### Step 4: CSS追加 (web/style.css)

**詳細設計書の18.1.3節を参照してください。**

追加内容:
- ボタンのスタイル
- 凡例のスタイル

---

## ✅ 動作確認方法

### 1. APIサーバー起動
```bash
python src/api_server.py
```

### 2. ブラウザで確認
```
http://localhost:5000
```

### 3. 確認項目
- [ ] 単勝オッズグラフが表示される(既存機能)
- [ ] 「単勝のみ」ボタンをクリックすると単勝のみ表示
- [ ] 「複勝のみ」ボタンをクリックすると複勝のみ表示
- [ ] 「両方表示」ボタンをクリックすると両方表示
- [ ] 複勝オッズが下限と上限の範囲で表示される
- [ ] 凡例が正しく表示される

---

## 🚨 質問すべきタイミング

以下の場合は**必ず質問**してください:

1. 既存のコードの意図が不明な場合
2. Chart.jsのバージョンが不明で実装方法が分からない場合
3. 既存のスタイルと競合する場合
4. APIレスポンスの形式が想定と異なる場合
5. その他、実装方針に迷った場合

**質問例**:
- 「既存のChart.js設定で`fill`オプションの使い方が分かりません。どのように実装すべきですか?」
- 「既存のボタンスタイルと統一したいのですが、どのクラスを使えばいいですか?」

---

## 📝 実装完了後の報告

実装完了後、以下を報告してください:

1. 修正したファイル一覧
2. 追加した機能の説明
3. 動作確認結果
4. 気づいた点や改善提案(あれば)

---

## 🎯 まとめ

**あなたの役割**: Webダッシュボードに複勝オッズ表示機能を追加  
**参照ファイル**: `docs/要件定義書/要件定義書_v0.82.md`, `docs/詳細設計書/詳細設計書_v0.82.md`  
**修正ファイル**: `web/index.html`, `web/app.js`, `web/style.css`  
**重要**: 既存機能を壊さない、迷ったら質問する

---

**実装を開始してください。質問があればいつでもどうぞ!**
